# microCMS でのブログの書き方

ここでは、独自に追加したクラスやその他の詳細について書きます。
今後ブログを書く人や、新たにクラスや処理を追加したい場合は、この文章を参考にしてください。

## 基本的な書き方

### タイトル

ブログに必ずつけてください。記事一覧として表示するため、あまり長すぎず適度な長さにしてください。

### 説明

必要があれば記入してください。これは、リンクとして共有するときなどの説明文となるので、必要なかったり書くことがないときは書かなくても大丈夫です。

### タグ

一つ以上つけてください。
タグを追加するときは、[パーサーについて ↗](#パーサーについて)を参照してください。

### 本文

使える書式は下記のとおりです。

| 項目           | 説明 　                                                        |
| -------------- | -------------------------------------------------------------- |
| 見出し2 , 3    | 見出しを作成します。                                           |
| Bold           | テキストを太字にします。                                       |
| Italic         | テキストを斜体にします。                                       |
| Underline      | テキストに下線を引きます。                                     |
| Strike-through | テキストに取り消し線を引きます。                               |
| Code           | コードを表示します。                                           |
| 横位置         | テキストの位置を調整します。                                   |
| 水平線         | 水平線を描きます。                                             |
| 引用           | テキストを引用します。                                         |
| CodeBlock      | 複数行のコードを表示します。                                   |
| テーブル       | テーブルを作成します。                                         |
| リスト         | リストを作成します。                                           |
| 番号付きリスト | 番号付きのリストを作成します。                                 |
| リンク         | リンクを作成します。                                           |
| 画像           | 画像を挿入します。                                             |
| 埋め込み       | 外部コンテンツを埋め込みます。                                 |
| アイコン       | [icones ↗](https://icones.js.org)にあるアイコンを表示します。 |

### テーブルについて

テーブルに関しては、処理の複雑さや容量の増加を考えて、`TextFormat` （ [`parser.ts` ↗](src/lib/utils/services/parser.ts) の型宣言の部分にあります ） にある基本的なものと画像のみとなっています。

### アイコンについて

microCMS のカスタムクラスに、アイコンというものが追加されているので、 [icones ↗](https://icones.js.org) から使いたいアイコンの `mid:` などの部分をコピペして、張り付けた部分をアイコンというクラスに設定してください。

基本的にはサイズは文字の大きさに合わせていますが、文字列の最後に `$$00` のように `$$` ＋ 半角数字で指定することで大きさを変えることができます。
なお、**この大きさは相対値**なので「基本のサイズプラスいくつ」で考えて作成してください。

ex)

通常

- `mdi:github` → microCMS でクラスを「アイコン」に設定

文字サイズを指定する場合

- `mdi:github$$40` → microCMS でクラスを「アイコン」に設定 ＋ サイズを縦横 40 に設定

---

## 画面プレビューについて

microCMS では、画面プレビューという機能を用いて実際に投稿したときのプレビューを見ることができます。投稿の前に必ず確認して、正しく書けているか・許容されているフォーマットかどうかなどを確認してください。

---

## パーサーについて

この章は、[`parsr.ts` ↗](src/lib/utils/services/parser.ts) を参照しながら読んでください。

### 型定義

まず、HTML要素を表現するための型が定義されています。これらは、HTMLの各要素（段落、見出し、リスト、テーブルなど）を表現するためのものです。例えば、`MainElement` 型は、HTMLの主要な要素を表現します。これらの型は、パーサーがHTMLを解析し、特定の形式に変換する際に使用されます。

### パーサー関数

次に、各HTML要素を解析するための関数が定義されています。これらの関数は、HTML要素を受け取り、対応する型のオブジェクトを返します。例えば、`processText` 関数は、HTMLのテキストノードを解析し、`Content` 型のオブジェクトを生成します。

### 新たな追加方法

新たなHTML要素をパースする機能を追加するには、以下の手順を守ってください。

1. **型定義の追加：** まず、新たなHTML要素を表現するための型を定義します。これは、既存の型定義を参考にして行ってください。
2. **パーサー関数の作成：** 次に、新たなHTML要素を解析するための関数を作成します。この関数は、HTML要素を受け取り、1で定義した型のオブジェクトを返すようにします。
3. **メインパーサーの更新：** 最後に、メインのパーサー関数を更新して、新たに作成したパーサー関数を呼び出すようにします。これにより、新たなHTML要素が適切に解析され、特定の形式に変換されます。
4. **表示の更新：** 最後に、[`src/routes/blogs/[slug]/+page.svelte` ↗](src/routes/blogs/[slug]/+page.svelte) や [`src/lib/components/BlogParser.svelte` ↗](src/lib/components/BlogParser.svelte) などを更新して、パースしたものが正しく描写されるようにしてください。

カスタムクラスを追加するときは、基本的に `<span class="custom-class"></span>` が `p` タグの中に入っているので、`className` によって条件を分岐させてください。

具体的には、下記の部分を変更します。

[`parser.ts` ↗](src/lib/utils/services/parser.ts)

```diff
- type SpanElement = { type: 'icon', content: string, size?: number }

+ type SpanElement =
+   | { type: 'icon', content: string, size?: number }
+   | { type: 'newClass', content: Content };
```

また、`processSpan` 関数で下記の部分に追記し、条件の分岐を行います。

```diff
   if (className === 'icon') {
          const match = content.match(/\$\$(\d+)$/);
           if (match) {
              content = content.replace(/\$\$\d+$/, '');
              size = parseInt(match[1], 10);
        }
          return { type: 'icon', content, size };
-  }

+  } else if (className === 'newClass') {
+      //新しい処理
+  }
```
